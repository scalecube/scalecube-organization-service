Feature: Organization service members management - Invite member

  I'm as the organization Owner or Admin want to invite authorized users to my organization.


  #MPA-7229 (#1)
  Scenario: Successful "member" invitation to multiple Organizations which belongs to different owners
    Given each of the users "A" and "B" have got a valid "token" issued by relevant authority
    And only two organizations "organizationId" with specified "name" and "email" which don't contain any "member" already created and owned by each of the user's "A" and "B"
    And the user "C" have got the "userId" issued by relevant authority
    When each of the users "A" and "B" requested to invite the user "C" to step into own organization "organizationId"
    Then the user "C" should become the "member" in each from both organizations which belong to the users "A" and "B" accordingly
    And each of the users "A" and "B" should get successful response with the empty object


  #MPA-7229 (#2)
  Scenario: Successful "member" invitation to multiple Organizations which belongs to single owner
    Given the user "A" have got a valid "token" issued by relevant authority
    And several organizations "organizationId-1" and "organizationId-2" with specified "names" and "emails" which don't contain any "member" already created and owned by user "A"
    And the user "B" have got the "userId" issued by relevant authority
    When the user "A" requested to invite the user "B" to step into each own organization "organizationId-1" and "organizationId-2"
    Then the user "B" should become the "member" in each of both user's "A" organizations
    And user "A" should get successful responses with the empty object


  #MPA-7229 (#3)
  Scenario: Successful invitation of the "member" into specific Organization upon it's existent "member" was granted with "admin" role
    Given the user "A" have got a valid "token" issued by relevant authority
    And only single organization "organizationId" with specified "name" and "email" already created and owned by user "A"
    And the user "B" who have got the "userId" issued by relevant authority was invited to user's "A" organization and promoted to "admin" role
    And the user "C" have got the "userId" issued by relevant authority
    When the user "B" requested to invite user "C" to step into user's "A" organization "organizationId"
    Then the user "C" should become the "member" of user's "A" organization
    And user "B" should get successful response with the empty object


  #MPA-7229 (#4)
  Scenario: Successful invitation of the "member" into specific Organization upon it's existent "member" was granted with "owner" role
    Given the user "A" have got a valid "token" issued by relevant authority
    And only single organization "organizationId" with specified "name" and "email" already created and owned by user "A"
    And the user "B" who have got the "userId" issued by relevant authority was invited to user's "A" organization and promoted to "owner" role
    And the user "C" have got the "userId" issued by relevant authority
    When the user "B" requested to invite user "C" to step into user's "A" organization "organizationId"
    Then the user "C" should become the "member" of user's "A" organization
    And user "B" should get successful response with the empty object


  #MPA-7229 (#5)
  Scenario: Ignore to invite the existent "member" (duplicate) to the same Organization
    Given the user "A" have got a valid "token" issued by relevant authority
    And only single organization "organizationId" with specified "name" and "email" already created and owned by this user "A"
    And the user "B" who have got the "userId" issued by relevant authority was invited to user's "A" organization as a "member" role
    When the user "A" requested to invite the existent user "B" to step into organization of user's "A" again
    Then the user "B" shouldn't be duplicated as the existent "member" in the user's "A" organization thus ignored by the system
    And user "A" should get successful response with the empty object


  #MPA-7229 (#6) - SHOULD WE IMPLEMENT SOME RESPONSE LIKE :"Invalid userId" (instead of plain acknowledgement)
  Scenario: Fail to invite the user to specific Organization upon this user is unauthorized (invalid or non-existent)
    Given the user "A" have got a valid "token" issued by relevant authority
    And only single organization "organizationId" with specified "name" and "email" already created and owned by user "A"
    And the user "D" have got the invalid "userId"
    When the user "A" requested to invite the user "D" to step into user's "A" organization
    Then user "D" shouldn't become the "member" of the user's "A" organization thus ignored by the system
    And user "A" should get successful response with the empty object


  #MPA-7229 (#7)
  Scenario: Fail to invite the user into a specific Organization upon the existing member got "member" role permission level
    Given the user "A" have got a valid "token" issued by relevant authority
    And only single organization "organizationId" with specified "name" and "email" already created and owned by user "A"
    And the user "B" who have got the "userId" issued by relevant authority was invited to user's "A" organization as a "member" role
    And the user "C" have got the "userId" issued by relevant authority
    When the user "B" requested to invite user "C" to step into user's "A" organization "organizationId"
    Then user "B" should get an error message: "user: 'userId "B"', name: 'null', not in role Owner or Admin of organization: 'org "B" name'"


  #MPA-7229 (#8)
  Scenario: Fail to invite the user into a specific Organization upon the existing (requester) owner was removed from own Organization
    Given the user "A" have got a valid "token" issued by relevant authority
    And only single organization "organizationId" with specified "name" and "email" already created and owned by user "A"
    And the user "B" who have got the "userId" issued by relevant authority was invited to user's "A" organization and promoted to "owner" role
    And the user "C" have got the "userId" issued by relevant authority
    And the user "A" was removed from own organization "organizationId"
    When the user "A" requested to invite user "C" to step into former user's "A" organization "organizationId"
    Then user "A" should get an error message: "user: 'userId "A"', name: 'null', not in role Owner or Admin of organization: 'org "A" name'"


  #MPA-7229 (#9)
  Scenario: Fail to invite the user to specific Organization if the token is invalid (expired)
    Given a user "D" have got the invalid either expired "token"
    When user "D" requested to invite some another user "userId" to some organization "organizationId"
    Then user "D" should receive the error message: "Token verification failed"
